<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>散步背单词</title>
    <meta name="author" content="目薬">
    <meta name="copyright" content="目薬">
    <link rel="shortcut icon" href="img/favicon.png">
    <style type="text/css">
        .topright{
        float:right;
        margin-top:0px;
        margin-right:0px;
        line-height:0%;
        font-size:0.85em;
        color:#cc8800;
        vertical-align:top;
        }
        .hintText{
        line-height:50%;
        font-size:0.6em;
        color:#cc8800;
        }
    </style>
</head>
<body style="background-color:#ffd480" onunload="setCookie()">
    <div class="topright">
        <!-- div id="signIn" onclick="signIn()" style="text-decoration:underline">登录</div-->
    </div>
    <h2>背单词</h2>
    <h4 id="word">加载中，请稍候...</h4>
    <h4 id="meaning" hidden></h4>
    <form name="input">
        <input type="text" name="inputbox" oninput="check()" onmousemove="showHint()" onmouseout="hideHint()"/>
    </form>
    <p class="hintText" id="hint"><br /></p>
    <button id="know" onclick="showWord()" hidden>我认识</button>
    <button id="notknow" onclick="showMeaning()" hidden>我不认识</button>
    <br /><br />
    <button id="switch" onclick="modeswitch()">切换模式</button>
    <p class="hintText" id="amount"><br />你今天已经认识了<span>未知</span>个单词，总共打卡<span>未知</span>天，认识了<span>未知</span>个单词</p>
</body>
<script type="text/javascript">
    var word;
    var mode = "write";
    var knowAmount = -1;
    var days = 0;
    var allwords = -1;
    var d = new Date();
    d.setTime(d.getTime()+90*24*60*60*1000);
    var expires = "expires="+d.toGMTString();
    checkCookie();
    showWord();

    function checkCookie()
    {
        var cookie = document.cookie;
        var today = new Date();
        today.setTime(today.getTime());

        if (cookie == "")
        {
            var newCookie = "knowAmount=-1;wordsAmount=50;days=0;allwords=-1;today="+today.toGMTString()+";"+expires;
            document.cookie = newCookie;
        }
        else
        {
            if (getCookie("today")==today.toGMTString())
            {
                knowAmount = Number(getCookie("knowAmount"));
            }
            days = Number(getCookie("days"));
            allwords = Number(getCookie("allwords"));
        }
    }

    function setCookie()
    {
        document.cookie = "knowAmount="+knowAmount.toString()+";wordsAmount=50;days="+days.toString()+";allwords="+allwords.toString()+";today="+today.toGMTString+";"+expires;
    }

function getCookie(cname)
{
  var name = cname + "=";
  var ca = document.cookie.split(';');
  for(var i=0; i<ca.length; i++) 
  {
    var c = ca[i].trim();
    if (c.indexOf(name)==0) return c.substring(name.length,c.length);
  }
  return "";
}

    function showHint()
    {
         document.getElementById("hint").innerHTML = "输入假名，按空格提交单词";
    }
    function hideHint()
    {
         document.getElementById("hint").innerHTML = "<br />";
    }

    function modeswitch()
    {
        if(mode =="write")
        {
            mode = "read";
        }
        else
        {
            mode = "write";
        }
        modeAct();
    }

function modeAct()
{
if(mode =="write")
        {
            document.getElementById("word").innerHTML=word.word;
            document.getElementById("know").setAttribute("hidden",true);
            document.getElementById("notknow").setAttribute("hidden",true);
            document.forms["input"]["inputbox"].removeAttribute("hidden");
            document.getElementById("meaning").removeAttribute("hidden");
        }
        else
        {
            document.getElementById("word").innerHTML=word.word+"("+word.furigana+")";
            document.getElementById("know").removeAttribute("hidden");
            document.getElementById("notknow").removeAttribute("hidden");
            document.forms["input"]["inputbox"].setAttribute("hidden",true);
            document.getElementById("meaning").setAttribute("hidden",true);
        }
}

function check()
{
var input = document.forms["input"]["inputbox"].value;
if(input==word.furigana+" ")
{
showWord();
document.forms["input"]["inputbox"].value = "";
}
} 

function showWord()
{
var xmlhttp;
if (window.XMLHttpRequest)
  {
  xmlhttp=new XMLHttpRequest();
  }
else
  {
  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  }
xmlhttp.onreadystatechange=function()
  {
  if (xmlhttp.readyState==4 && xmlhttp.status==200)
    {
    var result = JSON.parse(xmlhttp.responseText);
    result = result.RECORDS;
    word=result[Math.round(Math.random()*1699)]
    document.getElementById("meaning").innerHTML=word.meaning;
    modeAct();
    knowAmount++;
    allwords++;
    document.getElementById("amount").getElementsByTagName("span")[0].innerHTML=knowAmount.toString();
    document.getElementById("amount").getElementsByTagName("span")[1].innerHTML=days.toString();
    document.getElementById("amount").getElementsByTagName("span")[2].innerHTML=allwords.toString();
    }
}
xmlhttp.open("GET","https://megusuri56.github.io/words.json",true);
xmlhttp.send();
}
    function showMeaning()
    {
    document.getElementById("meaning").removeAttribute("hidden");
    }
</script>
</html>